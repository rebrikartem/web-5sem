<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Проекты</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="resources/stylesheets/todolist.css">
    <script src="todolist.js" defer> </script>
    <script src="loadTimeTracker.js"></script>
</head>

<body>
    <div id="items"></div>
    <template id="itemTemplate">
        <div class="item">
            <input type="checkbox" class="item-completed">
            <input type="text" class="item-description" placeholder="To Do item...">
        </div>
    </template>
    <button id="add">Add Item</button>

    <div id="preloader">Loading...</div>
    <div id="randomPhotoCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#randomPhotoCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#randomPhotoCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Next</span>
        </button>
        <ol class="carousel-indicators"></ol>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const preloader = document.getElementById('preloader');
            const carouselInner = document.querySelector('.carousel-inner');
            const carouselIndicators = document.querySelector('.carousel-indicators');

            function fetchData(url) {
                return fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    });
            }

            function renderPhotos(photos) {
                photos.forEach((photo, index) => {
                    const item = document.createElement('div');
                    item.className = index === 0 ? 'carousel-item active' : 'carousel-item';

                    const img = document.createElement('img');
                    img.src = photo.url;
                    img.alt = photo.title;
                    img.className = 'd-block w-50 mx-auto';
                    img.style.maxHeight = '600px';
                    img.style.maxWidth = '600px';

                    const caption = document.createElement('div');
                    caption.className = 'carousel-caption d-none d-md-block';
                    caption.innerHTML = `<h5>${photo.title}</h5><p>${photo.albumId}</p>`;

                    item.appendChild(img);
                    item.appendChild(caption);
                    carouselInner.appendChild(item);

                    // Add indicators
                    const indicator = document.createElement('li');
                    indicator.setAttribute('data-bs-target', '#randomPhotoCarousel');
                    indicator.setAttribute('data-bs-slide-to', index.toString());
                    if (index === 0) {
                        indicator.classList.add('active');
                    }
                    carouselIndicators.appendChild(indicator);
                });
            }

            function handleError(error) {
                photoContainer.innerHTML = '⚠ Something went wrong.';
                console.error('Error:', error.message);
            }

            function getRandomElementsFromArray(array, count) {
                const shuffledArray = array.slice();
                let currentIndex = shuffledArray.length;

                while (currentIndex !== 0) {
                    const randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;

                    const temporaryValue = shuffledArray[currentIndex];
                    shuffledArray[currentIndex] = shuffledArray[randomIndex];
                    shuffledArray[randomIndex] = temporaryValue;
                }

                return shuffledArray.slice(0, count);
            }

            function fetchDataAndRender(url) {
                preloader.style.display = 'block';

                fetchData(url)
                    .then(photos => {
                        renderPhotos(getRandomElementsFromArray(photos, 12));
                    })
                    .catch(error => {
                        handleError(error);
                    })
                    .finally(() => {
                        preloader.style.display = 'none';
                    });
            }

            // Example URL from JSONPlaceholder: Fetching photos
            const apiUrl = 'https://jsonplaceholder.typicode.com/photos';

            // Fetch data and render on page load
            fetchDataAndRender(apiUrl);
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
</body>

</html>